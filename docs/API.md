# FastText Serving API Documentation

## ğŸ¯ è®¾è®¡åŸåˆ™

1. **ä¸€è‡´æ€§**: Rustå’ŒPythonå®ç°æä¾›å®Œå…¨ç›¸åŒçš„API
2. **æ ‡å‡†åŒ–**: éµå¾ªRESTful APIè®¾è®¡è§„èŒƒ
3. **å…¼å®¹æ€§**: ä¿æŒå‘åå…¼å®¹
4. **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

## ğŸ“¡ HTTP API

### 1. é¢„æµ‹æ¥å£

#### `POST /predict`

**åŠŸèƒ½**: å¯¹æ–‡æœ¬è¿›è¡Œåˆ†ç±»é¢„æµ‹

**è¯·æ±‚**:
```json
{
  "url": "POST /predict?k=1&threshold=0.0",
  "headers": {
    "Content-Type": "application/json"
  },
  "body": ["text1", "text2", "text3"]
}
```

**å‚æ•°**:
- `k` (å¯é€‰): è¿”å›top-kä¸ªæ ‡ç­¾ï¼Œé»˜è®¤1
- `threshold` (å¯é€‰): é¢„æµ‹é˜ˆå€¼ï¼Œé»˜è®¤0.0

**å“åº”**:
```json
[
  {
    "labels": ["__label__0"],
    "scores": [0.9987]
  },
  {
    "labels": ["__label__1"],
    "scores": [0.8234]
  }
]
```

**é”™è¯¯å“åº”**:
```json
{
  "error": "Bad Request",
  "message": "Empty text input",
  "code": 400
}
```

### 2. å¥åº·æ£€æŸ¥

#### `GET /health`

**åŠŸèƒ½**: æ£€æŸ¥æœåŠ¡çŠ¶æ€

**å“åº”**:
```json
{
  "status": "healthy",
  "model_loaded": true,
  "implementation": "python",
  "version": "1.0.0",
  "model_path": "/path/to/model.bin"
}
```

### 3. å¥å‘é‡æ¥å£

#### `POST /sentence-vector`

**åŠŸèƒ½**: è·å–æ–‡æœ¬çš„å‘é‡è¡¨ç¤º

**è¯·æ±‚**:
```json
["text1", "text2"]
```

**å“åº”**:
```json
[
  [0.1, 0.2, 0.3, ...],
  [0.4, 0.5, 0.6, ...]
]
```

## ğŸ”§ æ ‡ç­¾æ ¼å¼è§„èŒƒ

### âš ï¸ é‡è¦å˜æ›´ï¼šä¿æŒå®Œæ•´æ ‡ç­¾æ ¼å¼

**ä¹‹å‰çš„é”™è¯¯å¤„ç†**:
```python
# âŒ é”™è¯¯ï¼šç§»é™¤__label__å‰ç¼€
labels.push(pred.label.trim_start_matches("__label__").to_string())
# ç»“æœï¼š["0", "1"] 
```

**æ­£ç¡®çš„å¤„ç†**:
```python
# âœ… æ­£ç¡®ï¼šä¿æŒå®Œæ•´æ ¼å¼
labels = ["__label__0", "__label__1"]
# ç»“æœï¼š["__label__0", "__label__1"]
```

## ğŸ“Š æ‰¹å¤„ç†è§„èŒƒ

### è¯·æ±‚é™åˆ¶
- **æœ€å¤§æ‰¹æ¬¡å¤§å°**: 1000ä¸ªæ–‡æœ¬
- **æœ€å¤§æ–‡æœ¬é•¿åº¦**: 10MB (å¯é…ç½®)
- **æœ€å¤§è¯·æ±‚å¤§å°**: 500MB (å¯é…ç½®)

### é”™è¯¯å¤„ç†
- **å•æ–‡æœ¬å¤±è´¥**: è¿”å›é”™è¯¯æ ‡è®°ï¼Œä¸å½±å“å…¶ä»–æ–‡æœ¬
- **æ‰¹æ¬¡éƒ¨åˆ†å¤±è´¥**: ç»§ç»­å¤„ç†å…¶ä»–æ–‡æœ¬
- **æ‰¹æ¬¡å®Œå…¨å¤±è´¥**: è¿”å›400é”™è¯¯

## ğŸš€ æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡æ€§èƒ½
- **Pythonå®ç°**: 2000-3000 samples/sec
- **Rustå®ç°**: 4000-5000 samples/sec
- **å“åº”æ—¶é—´**: <100ms (å•æ–‡æœ¬)
- **å†…å­˜ä½¿ç”¨**: <2GB

### ç›‘æ§æŒ‡æ ‡
- è¯·æ±‚æ•°/ç§’
- å¹³å‡å“åº”æ—¶é—´
- é”™è¯¯ç‡
- å†…å­˜ä½¿ç”¨ç‡
- CPUä½¿ç”¨ç‡

## ğŸ”’ é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| 400 | è¯·æ±‚é”™è¯¯ | ç©ºæ–‡æœ¬ã€æ ¼å¼é”™è¯¯ |
| 413 | è¯·æ±‚è¿‡å¤§ | è¶…å‡ºå¤§å°é™åˆ¶ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | æ¨¡å‹åŠ è½½å¤±è´¥ |
| 503 | æœåŠ¡ä¸å¯ç”¨ | æ¨¡å‹æœªåŠ è½½ |

## ğŸ“ å®¢æˆ·ç«¯ç¤ºä¾‹

### Pythonå®¢æˆ·ç«¯
```python
import requests

response = requests.post(
    'http://localhost:8000/predict',
    json=['print("hello world")'],
    params={'k': 1, 'threshold': 0.0}
)
result = response.json()
print(result[0]['labels'][0])  # __label__1
```

### curlç¤ºä¾‹
```bash
curl -X POST http://localhost:8000/predict \
  -H "Content-Type: application/json" \
  -d '["def hello(): return \"world\""]'
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æ ‡å‡†æµ‹è¯•ç”¨ä¾‹
1. **å•æ–‡æœ¬é¢„æµ‹**: ç¡®ä¿åŸºæœ¬åŠŸèƒ½æ­£å¸¸
2. **æ‰¹é‡é¢„æµ‹**: æµ‹è¯•å¹¶å‘å¤„ç†èƒ½åŠ›
3. **è¾¹ç•Œæ¡ä»¶**: ç©ºæ–‡æœ¬ã€è¶…é•¿æ–‡æœ¬ã€ç‰¹æ®Šå­—ç¬¦
4. **é”™è¯¯å¤„ç†**: å„ç§å¼‚å¸¸æƒ…å†µçš„å¤„ç†
5. **æ€§èƒ½æµ‹è¯•**: ååé‡å’Œå»¶è¿Ÿæµ‹è¯•

### å…¼å®¹æ€§æµ‹è¯•
1. **APIä¸€è‡´æ€§**: Rust vs Pythonå®ç°
2. **ç»“æœä¸€è‡´æ€§**: ç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡º
3. **é”™è¯¯ä¸€è‡´æ€§**: ç›¸åŒé”™è¯¯äº§ç”Ÿç›¸åŒå“åº”
